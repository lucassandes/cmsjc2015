<?phpinclude_once("../library/master-page.php");include_once("../library/validator.php");include_once("../library/config/database/tlicitacao.php");include_once("../library/config/database/tlicitacaoarquivo.php");include_once("../library/config/database/tlicitacaocadastro.php");$oLicitacao = new tlicitacao();$oLicitacaoArquivo = new tlicitacaoarquivo();if(!$oLicitacaoArquivo->LoadByPrimaryKey($_GET["id"]) || !$oLicitacao->LoadByPrimaryKey($oLicitacaoArquivo->LicitacaoID)){    header("Location: " . $oLicitacao->WebURL);    exit();}//post$bForm = true;$msg = "";if($oLicitacaoArquivo->CheckKeyForm($_POST)){    //vars    $txtNome = $_POST["txtNome"];    $txtCNPJCPF = $_POST["txtCNPJCPF"];    $txtEmail = $_POST["txtEmail"];    $txtCEP = $_POST["txtCEP"];    $txtEndereco = $_POST["txtEndereco"];    $txtNumero = $_POST["txtNumero"];    $txtComplemento = $_POST["txtComplemento"];    $txtBairro = $_POST["txtBairro"];    $txtCidade = $_POST["txtCidade"];    $ddlEstado = $_POST["ddlEstado"];    $txtTelefone = $_POST["txtTelefone"];    $txtFax = $_POST["txtFax"];    //valida??o    $oValidator = new Validator();    $oValidator->Add("Nome", $txtNome, true, null, "Digite o nome.");    $oValidator->Add("CNPJCPF", $txtCNPJCPF, true, ((strlen($txtCNPJCPF) <= 11) ? "cpf" : "cnpj"), "Digite o CNPJ/CPF corretamente.");    $oValidator->Add("Email", $txtEmail, true, "email", "Digite o e-mail corretamente.");    $oValidator->Add("CEP", $txtCEP, true, "cep", "Digite o e-mail corretamente.");    $oValidator->Add("Endereco", $txtEndereco, true, null, "Digite o endere?o.");    $oValidator->Add("Numero", $txtNumero, true, null, "Digite o n?mero.");    $oValidator->Add("Bairro", $txtBairro, true, null, "Digite o bairro.");    $oValidator->Add("Cidade", $txtCidade, true, null, "Digite a cidade.");    $oValidator->Add("Estado", $ddlEstado, true, null, "Selecione o estado.");    $oValidator->Add("Telefone", $txtTelefone, true, "phone", "Digite o telefone corretamente.");    $oValidator->Add("Fax", $txtFax, false, "phone", "Digite o fax corretamente.");    if($oValidator->Validate())    {        $oLicitacaoCadastro = new tlicitacaocadastro();        if(!$oLicitacaoCadastro->LoadByLicitacaoIDAndCNPJCPF($oLicitacao->ID, $txtCNPJCPF))        {            $oLicitacaoCadastro->AddNew();            $oLicitacaoCadastro->LicitacaoID = $oLicitacao->ID;            $oLicitacaoCadastro->DataHora = date("Y-m-d H:i:s");        }        $oLicitacaoCadastro->Nome = $txtNome;        $oLicitacaoCadastro->CNPJCPF = $txtCNPJCPF;        $oLicitacaoCadastro->Email = $txtEmail;        $oLicitacaoCadastro->CEP = $txtCEP;        $oLicitacaoCadastro->Endereco = $txtEndereco;        $oLicitacaoCadastro->Numero = $txtNumero;        $oLicitacaoCadastro->Complemento = $txtComplemento;        $oLicitacaoCadastro->Bairro = $txtBairro;        $oLicitacaoCadastro->Cidade = $txtCidade;        $oLicitacaoCadastro->Estado = $ddlEstado;        $oLicitacaoCadastro->Telefone = $txtTelefone;        $oLicitacaoCadastro->Fax = $txtFax;        $oLicitacaoCadastro->Save();        $oLicitacaoArquivo->SetSession();        //$bForm = false;        $bForm = true;    }    else    {        $msg = implode("\\r\\n", $oValidator->Message);    }}$oMasterPage = new MasterPage();$oMasterPage->Init("../master.php", "Licitações - Licitações em Aberto");$oMasterPage->AddParameter("css", "licitacoes/faca-o-download");$oMasterPage->AddParameter("pagina", "licitacoes");$oMasterPage->AddParameter("titulo", "licitacoes/licitacoes-em-aberto");$oMasterPage->AddParameter("msg", $msg);$oMasterPage->Open("PageContent");?><h1><?php echo (utf8_encode("Faça o download "));?> </h1><?php /*switch (utf8_encode($oLicitacao->ModalidadeLista[$oLicitacao->Modalidade])) {    case "Tomada de Preços":        $cor = "bs-callout-dark-blue";        break;    case "Pregão":        $cor = "bs-callout-red";        break;    case "Concorrência Pública":        $cor = "bs-callout-green";        break;    default:        $cor = "bs-callout-yellow";} */?><div class="container-box item-licitacao <?php echo $cor; ?>">    <h3><?= utf8_encode($oLicitacao->ModalidadeLista[$oLicitacao->Modalidade]); ?> -        Nº: <?= utf8_encode($oLicitacao->Numero); ?></h3>    <?php if (!$oLicitacao->IsClear($oLicitacao->Objeto)) { ?>        <?php        $string = $oLicitacao->HTMLDecode($oLicitacao->Objeto);        echo utf8_encode($string);        ?><?php    } ?></div><?phpif($bForm){	?>	<h3 class="zwo3Italic">Preencha os campos abaixo para fazer o download do arquivo:</h3>	<div class="formulario row">		<form action="" method="post" class="formAlert">			<?=$oLicitacaoArquivo->GenerateKeyForm();?>	    	<ul>	        	<li class="input330 col-md-6">	            	<label>	                	Nome:	                    <span><input value="<?=$txtNome;?>" type="text" id="txtNome" name="txtNome" maxlength="150" class="{required:true, focus:true} form-control" title="Digite o nome." /></span>	                </label>	            </li>	            <li class="input330 noMarginRight col-md-6">	            	<label>	                	CNPJ/CPF:	                    <span><input value="<?=$txtCNPJCPF;?>" type="text" id="txtCNPJCPF" name="txtCNPJCPF" maxlength="14" class="{required:true} form-control" title="Digite o CNPJ/CPF corretamente." /></span>	                </label>	            </li>	            <li class="input330 col-md-6">	            	<label>	                	E-mail:	                    <span><input value="<?=$txtEmail;?>" type="text" id="txtEmail" name="txtEmail" maxlength="150" class="{required:true, email:true} form-control" title="Digite o e-mail corretamente." /></span>	                </label>	            </li>	            <li class="input330 noMarginRight col-md-6">	            	<label>	                	CEP:	                    <span><input onkeyup="searchCEP();" value="<?=$txtCEP;?>" type="text" id="txtCEP" name="txtCEP" maxlength="9" class="{required:true, cep:true, mask:'99999-999'} form-control" title="Digite o CEP corretamente." /></span>	                </label>	            </li>	            <li class="input240 col-md-6">	            	<label>	                	<?php echo (utf8_encode("Endereço")); ?>:	                    <span><input value="<?=$txtEndereco;?>" type="text" id="txtEndereco" name="txtEndereco" maxlength="150" class="{required:true} form-control" title="Digite o endereço." /></span>	                </label>	            </li>	            <li class="input70 col-md-6">	            	<label>                        <?php echo (utf8_encode("Número")); ?>:	                    <span><input value="<?=$txtNumero;?>" type="text" id="txtNumero" name="txtNumero" maxlength="50" class="{required:true} form-control" title="Digite o número." /></span>	                </label>	            </li>	            <li class="input330 noMarginRight col-md-6">	            	<label>	                	Complemento:	                    <span><input value="<?=$txtComplemento;?>" type="text" id="txtComplemento" name="txtComplemento" class="form-control" maxlength="50" /></span>	                </label>	            </li>	            <li class="input330 col-md-6">	            	<label>	                	Bairro:	                    <span><input value="<?=$txtBairro;?>" type="text" id="txtBairro" name="txtBairro" maxlength="50" class="{required:true} form-control" title="Digite o bairro." /></span>	                </label>	            </li>	            <li class="input240 col-md-6">	            	<label>	                	Cidade:	                    <span><input value="<?=$txtCidade;?>" type="text" id="txtCidade" name="txtCidade" maxlength="50" class="{required:true} form-control" title="Digite a cidade." /></span>	                </label>	            </li>	            <li class="input70 noMarginRight col-md-6">	            	<label>	                	Estado:	                    <span>	                    	<select id="ddlEstado" name="ddlEstado" class="{required:true} form-control" title="Selecione o estado.">			                	<option value="" selected="selected">---</option>			                	<?php			                	foreach($oLicitacaoArquivo->UF as $c => $v)								{									?>									<option value="<?=$c;?>" <?php if($c == $ddlEstado) { ?> selected="selected" <?php } ?>><?=$c;?></option>									<?php								}			                	?>			                </select>	                    </span>	                </label>	            </li>	            <li class="input330 col-md-6">	            	<label>	                	Telefone:	                    <span><input value="<?=$txtTelefone;?>" type="text" id="txtTelefone" name="txtTelefone" maxlength="14" class="{required:true, phone:true, mask:'(99) 9999-9999'} form-control" title="Digite o telefone corretamente." /></span>	                </label>	            </li>	            <li class="input330 noMarginRight col-md-6">	            	<label>	                	Fax:	                    <span><input value="<?=$txtFax;?>" type="text" id="txtFax" name="txtFax" maxlength="14" class="{phone:true, mask:'(99) 9999-9999'} form-control" title="Digite o fax corretamente." /></span>	                </label>	            </li>	            <li class="botEnviar">                    <button type="submit" class="btn btn-default btn-lg margin-left">                        Enviar <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>                    </button>                    <input type="image" src="imgs/fale-conosco/bot-enviar.png" alt="Enviar" title="Enviar" />                </li>                <!--<li class="botVoltar text-right"><a href="licitacoes/licitacoes-em-aberto/" class="voltar">Voltar</a></li> -->	        </ul>		</form>	</div>	<?php}else{    echo("<script>alert('OK')</script>");	?>    <script language="javascript" type="text/javascript">        $(function(){            setTimeout("window.location.href = '<?=$oLicitacaoArquivo->DownloadURL($oLicitacaoArquivo->Arquivo);?>'", 10000);        });    </script>	<div class="agradecimento">	    <h3 class="zwo3Italic noMarginBottom">Obrigado!</h3>	    <p>	        Caso o download não inicie automaticamente clique no botão abaixo.<br />	        <a href="<?=$oLicitacaoArquivo->DownloadURL($oLicitacaoArquivo->Arquivo);?>" class="download">				<span></span>				<?=$oLicitacaoArquivo->Titulo;?>			</a>	    </p>	    <br clear="all" />	    <a href="licitacoes/licitacoes-em-aberto/" class="voltar">Voltar</a>	</div>    <?php}?><?php$oMasterPage->Close("PageContent");$oMasterPage->End();?>